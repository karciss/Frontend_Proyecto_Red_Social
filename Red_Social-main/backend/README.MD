# Backend - Red Social Universitaria ğŸ“

API REST desarrollada con FastAPI para la Red Social Universitaria de la Universidad del Valle Bolivia.

## ğŸš€ TecnologÃ­as

- **FastAPI 0.115.0+** - Framework web moderno y rÃ¡pido
- **Python 3.11+** - Lenguaje de programaciÃ³n
- **Supabase** - Base de datos PostgreSQL gestionada
- **JWT** - AutenticaciÃ³n con tokens
- **Bcrypt** - Hash de contraseÃ±as
- **Pydantic** - ValidaciÃ³n de datos

## ğŸ“ Estructura del Proyecto

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # Punto de entrada de FastAPI
â”‚   â”œâ”€â”€ config.py            # ConfiguraciÃ³n de la aplicaciÃ³n
â”‚   â”œâ”€â”€ database.py          # ConexiÃ³n a Supabase
â”‚   â”œâ”€â”€ models/              # Modelos Pydantic
â”‚   â”‚   â”œâ”€â”€ usuario.py       # Usuario, Estudiante, Docente
â”‚   â”‚   â”œâ”€â”€ academico.py     # GestiÃ³n acadÃ©mica, Materias, Notas
â”‚   â”‚   â”œâ”€â”€ social.py        # Publicaciones, Comentarios, Reacciones
â”‚   â”‚   â”œâ”€â”€ mensajeria.py    # Conversaciones y Mensajes
â”‚   â”‚   â”œâ”€â”€ carpooling.py    # Rutas y Pasajeros
â”‚   â”‚   â”œâ”€â”€ notificacion.py  # Notificaciones
â”‚   â”‚   â””â”€â”€ relacion.py      # Relaciones entre usuarios
â”‚   â”œâ”€â”€ routes/              # Endpoints/Rutas
â”‚   â”‚   â”œâ”€â”€ auth.py          # AutenticaciÃ³n (login, registro)
â”‚   â”‚   â”œâ”€â”€ usuarios.py      # CRUD de usuarios
â”‚   â”‚   â”œâ”€â”€ estudiantes.py   # GestiÃ³n de estudiantes
â”‚   â”‚   â”œâ”€â”€ docentes.py      # GestiÃ³n de docentes
â”‚   â”‚   â”œâ”€â”€ materias.py      # GestiÃ³n de materias
â”‚   â”‚   â”œâ”€â”€ notas.py         # Consulta de notas
â”‚   â”‚   â”œâ”€â”€ horarios.py      # Consulta de horarios
â”‚   â”‚   â”œâ”€â”€ grupos.py        # GestiÃ³n de grupos
â”‚   â”‚   â”œâ”€â”€ publicaciones.py # Red social - Publicaciones
â”‚   â”‚   â”œâ”€â”€ comentarios.py   # Red social - Comentarios
â”‚   â”‚   â”œâ”€â”€ reacciones.py    # Red social - Reacciones
â”‚   â”‚   â”œâ”€â”€ mensajes.py      # MensajerÃ­a privada/grupal
â”‚   â”‚   â”œâ”€â”€ notificaciones.py# Notificaciones
â”‚   â”‚   â”œâ”€â”€ rutas.py         # Carpooling - Rutas
â”‚   â”‚   â””â”€â”€ pasajeros.py     # Carpooling - Pasajeros
â”‚   â””â”€â”€ utils/               # Utilidades
â”‚       â”œâ”€â”€ security.py      # JWT, Hash, Seguridad
â”‚       â””â”€â”€ dependencies.py  # Dependencias reutilizables
â”œâ”€â”€ .env                     # Variables de entorno (NO subir a git)
â”œâ”€â”€ .env.example             # Ejemplo de variables de entorno
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt         # Dependencias Python
â”œâ”€â”€ baseDeDatos.md          # Esquema de base de datos
â”œâ”€â”€ requerimientos.md       # Requerimientos funcionales
â””â”€â”€ README.md
```

## ğŸ”§ InstalaciÃ³n y ConfiguraciÃ³n

### 1. Crear entorno virtual

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python3 -m venv venv
source venv/bin/activate
```

### 2. Instalar dependencias

```bash
pip install -r requirements.txt
```

### 3. Configurar variables de entorno

Crear archivo `.env` basado en `.env.example`:

```env
# Supabase
SUPABASE_URL=https://tu-proyecto.supabase.co
SUPABASE_KEY=tu-clave-anonima
SUPABASE_SERVICE_KEY=tu-clave-de-servicio

# Seguridad
SECRET_KEY=tu-clave-secreta-super-segura-cambiar-en-produccion
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Entorno
ENVIRONMENT=development
DEBUG=True
```

### 4. Ejecutar la aplicaciÃ³n

```bash
# Modo desarrollo (con recarga automÃ¡tica)
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Modo producciÃ³n
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

La API estarÃ¡ disponible en:
- **DocumentaciÃ³n Swagger**: http://localhost:8000/docs
- **DocumentaciÃ³n ReDoc**: http://localhost:8000/redoc
- **Health Check**: http://localhost:8000/health

## ğŸ“š Endpoints Principales

### ğŸ” AutenticaciÃ³n

- `POST /api/v1/auth/register` - Registrar nuevo usuario
- `POST /api/v1/auth/login` - Iniciar sesiÃ³n
- `POST /api/v1/auth/refresh` - Refrescar token
- `GET /api/v1/auth/me` - Obtener usuario actual

### ğŸ‘¥ Usuarios

- `GET /api/v1/usuarios` - Listar usuarios
- `GET /api/v1/usuarios/{id}` - Obtener usuario
- `PUT /api/v1/usuarios/{id}` - Actualizar usuario
- `DELETE /api/v1/usuarios/{id}` - Eliminar usuario
- `GET /api/v1/usuarios/search/query` - Buscar usuarios

### ğŸ“ MÃ³dulo AcadÃ©mico

- `GET /api/v1/materias/mis-materias` - Mis materias
- `GET /api/v1/notas/mis-notas` - Mis notas
- `GET /api/v1/horarios/mi-horario` - Mi horario
- `GET /api/v1/estudiantes/me` - Mis datos de estudiante

### ğŸ“± Red Social

- `POST /api/v1/publicaciones` - Crear publicaciÃ³n
- `GET /api/v1/publicaciones` - Feed de publicaciones
- `POST /api/v1/comentarios` - Comentar publicaciÃ³n
- `POST /api/v1/reacciones` - Reaccionar a publicaciÃ³n/comentario

### ğŸ’¬ MensajerÃ­a

- `POST /api/v1/mensajes/conversaciones` - Crear conversaciÃ³n
- `GET /api/v1/mensajes/conversaciones` - Mis conversaciones
- `POST /api/v1/mensajes` - Enviar mensaje
- `GET /api/v1/mensajes/conversacion/{id}` - Mensajes de conversaciÃ³n
- `GET /api/v1/mensajes/no-leidos` - Mensajes no leÃ­dos

### ğŸš— Carpooling

- `POST /api/v1/rutas-carpooling` - Crear ruta
- `GET /api/v1/rutas-carpooling` - Listar rutas disponibles
- `GET /api/v1/rutas-carpooling/mis-rutas` - Mis rutas
- `POST /api/v1/pasajeros` - Postular como pasajero
- `PUT /api/v1/pasajeros/{id}` - Aceptar/rechazar pasajero

### ğŸ”” Notificaciones

- `GET /api/v1/notificaciones` - Mis notificaciones
- `GET /api/v1/notificaciones/no-leidas` - Notificaciones no leÃ­das
- `PUT /api/v1/notificaciones/{id}/leer` - Marcar como leÃ­da

## ğŸ”’ AutenticaciÃ³n y AutorizaciÃ³n

La API utiliza **JWT (JSON Web Tokens)** para autenticaciÃ³n:

1. El cliente se registra o inicia sesiÃ³n
2. El servidor devuelve un `access_token` y `refresh_token`
3. El cliente incluye el token en el header: `Authorization: Bearer <token>`
4. Los endpoints protegidos verifican el token y los permisos

### Roles disponibles:
- **estudiante**: Acceso a mÃ³dulo acadÃ©mico (consulta), red social, carpooling
- **docente**: Acceso a gestiÃ³n de notas y materias
- **administrador**: Acceso completo al sistema

## ğŸ—„ï¸ Base de Datos

La base de datos estÃ¡ implementada en **PostgreSQL** a travÃ©s de **Supabase**. 

Ver esquema completo en: [`baseDeDatos.md`](./baseDeDatos.md)

### Tablas principales:

- **Usuario**: InformaciÃ³n bÃ¡sica de usuarios
- **Estudiante**: Datos acadÃ©micos de estudiantes
- **Docente**: Datos de docentes
- **Materia**: Asignaturas
- **Nota**: Calificaciones
- **Horario**: Horarios de clases
- **Publicacion**: Publicaciones de red social
- **Comentario**: Comentarios en publicaciones
- **Reaccion**: Reacciones (like, love, etc.)
- **Conversacion**: Conversaciones privadas/grupales
- **Mensaje**: Mensajes de chat
- **Ruta**: Rutas de carpooling
- **PasajeroRuta**: Pasajeros en rutas
- **Notificacion**: Notificaciones del sistema

## ğŸ§ª Testing

```bash
# Ejecutar tests
pytest

# Con cobertura
pytest --cov=app --cov-report=html
```

## ğŸ“ Notas de Desarrollo

### Convenciones de cÃ³digo:
- Nombres de variables y funciones: `snake_case`
- Nombres de clases: `PascalCase`
- Constantes: `UPPER_CASE`
- DocumentaciÃ³n: Docstrings en espaÃ±ol

### Buenas prÃ¡cticas:
- ValidaciÃ³n de datos con Pydantic
- Manejo de errores con HTTPException
- Logging de operaciones importantes
- AutenticaciÃ³n JWT en todas las rutas protegidas
- Control de acceso basado en roles

## ğŸš€ Despliegue

### Variables de entorno de producciÃ³n:

```env
ENVIRONMENT=production
DEBUG=False
SECRET_KEY=<clave-segura-generada-aleatoriamente>
```

### Recomendaciones:
- Usar HTTPS en producciÃ³n
- Configurar CORS apropiadamente
- Usar variables de entorno seguras
- Implementar rate limiting
- Monitorear logs y errores

## ğŸ“„ Licencia

Este proyecto es parte de la Universidad del Valle Bolivia.

## ğŸ‘¥ Equipo de Desarrollo

Red Social Universitaria - Universidad del Valle Bolivia

---

**Â¿Necesitas ayuda?** Consulta la documentaciÃ³n en `/docs` o contacta al equipo de desarrollo.
â”‚   â”‚   â””â”€â”€ usuarios.py
â”‚   â””â”€â”€ utils/               # Utilidades
â”‚       â”œâ”€â”€ security.py      # Hash, JWT, etc.
â”‚       â””â”€â”€ dependencies.py  # Dependencias reutilizables
â”œâ”€â”€ .env                     # Variables de entorno (NO subir a git)
â”œâ”€â”€ .env.example             # Ejemplo de variables de entorno
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt         # Dependencias del proyecto
â””â”€â”€ README.md
```

